# Backend Directory Information

This file explains the purpose and functionality of each file in the `backend/` directory of the Smart Home project.

## Core Application Files

### 1. `main.py`
**The Entry Point of the Application**
- Initializes the `FastAPI` application server.
- Handles all incoming HTTP requests (e.g., `/command/`, `/voice` for voice commands).
- Manages WebSocket endpoints (`/ws/client`, `/ws/device`) for real-time communication between the frontend and ESP32 devices.
- Integrates all other modules (`database`, `ai_service`, `connection_manager`) into a cohesive system.
- Serves the frontend static files.

### 2. `ai_service.py`
**The User Intent Processor**
- Acts as the brain of the system using Ollama (AI Model).
- Receives raw text from voice commands (e.g., "Turn on the kitchen lights").
- Processes the text to understand the user's intent.
- Returns structured actions (e.g., `{"action": "turn_on", "device": "kitchen_light"}`) that the system can execute.

### 3. `connection_manager.py`
**Real-Time Communication Hub**
- Manages all active WebSocket connections (Web clients and ESP32 devices).
- Handles broadcasting messages to all connected clients (e.g., updating UI when a switch is toggled physically).
- Directs specific commands to specific devices.
- Ensures state synchronization between the web interface and physical hardware.

### 4. `database.py`
**Database Configuration**
- Sets up the connection to the SQLite database (`database.db`).
- Configures the database engine using SQLModel/SQLAlchemy.
- Provides dependency functions (`get_session`) for other parts of the app to access data securely.

### 5. `models.py`
**Data Structures (Schema)**
- Defines the structure of the data stored in the database.
- Describes what a "Device" looks like (id, name, type, status).
- Describes what a "User" looks like.
- Ensures data consistency across the application.

## Subdirectories

### `firmware/`
- Contains the code that runs on the physical ESP32 microcontroller.
- **`boot.py`**: Runs on startup to connect the ESP32 to WiFi.
- **`main.py`**: Runs after boot; connects to the Backend WebSocket server to receive commands (turn on/off pins) and report status.

### `__pycache__`
- Automatically generated by Python. Contains compiled bytecode files that make the application run faster. You can safely ignore this folder.

## External Data
- **`../database/database.db`**: The actual SQLite database file where device states and logs are stored. It is located in the sibling `database` folder.
